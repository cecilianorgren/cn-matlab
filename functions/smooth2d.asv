function out = smooth2d(A,np)

[nx,ny] = size(A);
B = zeros(nx,ny);


for iy = 1:ny
  B(np+np:nx-np,iy) = smooth(A,2*np+1,iy);
  Ashift = circshift(A,np,1);
  Btmp = Ashift;
  Btmp(np+np:nx-np,iy) = smooth(Ashift,2*np+1,iy);
  B()
end